<!DOCTYPE html>
<html>
<head>
    <title>Heart Disease Prediction</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h2>Heart Disease Prediction Form</h2>

    {% with messages = get_flashed_messages(category_filter=["error"]) %}
      {% if messages %}
        <ul style="color: red;">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <form method="POST" enctype="multipart/form-data">
        <!-- Single Patient Input Fields -->
        Age: <input type="number" name="age" min="1" max="120" required><br>

        Sex:
        <select name="sex" required>
            <option value="" disabled selected>Select sex</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select><br>

        Chest Pain Type:
        <select name="cp" required>
            <option value="" disabled selected>Select chest pain type</option>
            <option value="typical angina">typical angina</option>
            <option value="atypical angina">atypical angina</option>
            <option value="non-anginal">non-anginal</option>
            <option value="asymptomatic">asymptomatic</option>
        </select><br>

        Resting BP: <input type="number" name="trestbps" min="50" max="250" required><br>

        Cholesterol: <input type="number" name="chol" min="100" max="600" required><br>

        Fasting Blood Sugar:
        <select name="fbs" required>
            <option value="" disabled selected>Select FBS</option>
            <option value="True">True</option>
            <option value="False">False</option>
        </select><br>

        Rest ECG Result:
        <select name="restecg" required>
            <option value="" disabled selected>Select rest ECG</option>
            <option value="normal">normal</option>
            <option value="lv hypertrophy">lv hypertrophy</option>
            <option value="ST-T wave abnormality">ST-T wave abnormality</option>
        </select><br>

        Max Heart Rate: <input type="number" name="thalach" min="60" max="220" required><br>

        Exercise Induced Angina:
        <select name="exang" required>
            <option value="" disabled selected>Select exang</option>
            <option value="True">True</option>
            <option value="False">False</option>
        </select><br>

        Oldpeak: <input type="number" step="0.1" name="oldpeak" min="0" max="10" required><br>

        Slope:
        <select name="slope" required>
            <option value="" disabled selected>Select slope</option>
            <option value="upsloping">upsloping</option>
            <option value="flat">flat</option>
            <option value="downsloping">downsloping</option>
        </select><br>

        Ca: <input type="number" name="ca" min="0" max="3" required><br>

        Thal:
        <select name="thal" required>
            <option value="" disabled selected>Select thal</option>
            <option value="normal">normal</option>
            <option value="fixed defect">fixed defect</option>
            <option value="reversable defect">reversable defect</option>
        </select><br><br>

        <input type="submit" value="Predict">
    </form>

    {% if prediction %}
        <h3>Prediction: {{ prediction }}</h3>
        {% if confidence %}
            <p>Confidence: {{ confidence }}%</p>
        {% endif %}
    {% endif %}

    <hr>

    <!-- Bulk CSV Upload Form -->
    <h2>Bulk Patient Prediction (CSV Upload)</h2>
    <form method="POST" enctype="multipart/form-data">
        <input type="file" name="csvfile" accept=".csv" required>
        <input type="submit" value="Upload and Predict">
    </form>

    {% if download_link %}
        <p>
          <a href="{{ url_for('download_file', filename=download_link) }}">Download Results CSV</a>
        </p>
    {% endif %}
</body>
</html>
